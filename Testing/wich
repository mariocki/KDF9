SOURCE=${KIDSGROVE:-Kidsgrove}
DATA=${KDF9_DATA:-Data}
BINARY=${KDF9_BINARY:-Binary}
USERCODE=${KDF9_USERCODE:-Assembly}
ID="`basename $0`: "

if [ x$1x = xx ]
then
   echo; echo ${ID} No program name was given.; echo
   exit 1
fi

name=$1

if [ ! -r ${SOURCE}/$name.a60 ]
then
   echo; echo ${ID} ${SOURCE}/$name.a60 was not found.; echo
   exit 2
fi

if [ -s settings_for_kalgol.txt ]
then
   cp settings_for_kalgol.txt settings_1.txt
fi
shift

export KIDSGROVE_PEEPHOLE=y

kalgol $name with OPTIMISER ${KIDSOPTS}
if [ ! -s ${USERCODE}/$name.k3 ]
then
   exit 3
fi

if [ -s ${BINARY}/$name-OPT ]
then
   cp settings_2.txt settings_1.txt
   nine $name-OPT $1 $2 $3 $4
else
   exit 3
fi
