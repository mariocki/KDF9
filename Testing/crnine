BINARY=${KDF9_BINARY:-Binary}
DATA=${KDF9_DATA:-Data}
ID="`basename $0`: "

prog=$1
data=$2


cp FW0 FW0_copy

if [ x"${prog}"x = xx ]
then
   echo ${ID} You have not named a binary program to be run.
   echo
   exit 1
fi

program=`basename "${prog}"`
program=${BINARY}/"$program"
if [ ! -r "$program" ]
then
   echo ${ID} The object code file "$program" is absent or unreadable.
   echo
   exit 2
fi

if [ x"${data}"x = xx -o x"${data}"x = x-x ]
then
   >CR0
else
   datatxt=${DATA}/`basename "${data}" ".txt"`.txt
   if [ -r "$datatxt" ]
   then
      cp "$datatxt" CR0
   else
      datatxt=${DATA}/`basename "${data}"`
      if [ -r "$datatxt" ]
      then
         cp "$datatxt" CR0
      else
         echo ${ID} The file "$datatxt" is absent or unreadable.
         exit 3
      fi
   fi
fi

mode=-d$3
miscellany=-m$4
if   [ "$mode" = -d ]
then
        ee9 -sp -df "$miscellany" +"$program";
elif [ "$3" = - ]
then
        ee9 -sp -df "$miscellany" +"$program";
elif [ "$mode" = -df ]
then
   time ee9 -sp -df "$miscellany" +"$program";
else
        ee9 -sp "$mode" "$miscellany"  +"$program";
fi

case $4 in
   *z*)
      ;;
   *l*)
      ;;
   -)
      if [ -s LP0 ]
      then
         echo
         echo LP0:
         echo ===
         more LP0
         echo ===
      fi
      ;;
   *)
      if [ -s CP0 ]
      then
         echo
         echo CP0:
         echo ===
         more CP0
         echo ===
      fi

      if [ -s TP0 ]
      then
         echo
         echo TP0:
         echo ===
         more TP0
         echo ===
      fi

      if [ -s LP0 ]
      then
         echo
         echo LP0:
         echo ===
         more LP0
         echo ===
      fi
esac
